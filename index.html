<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Cars Showcase</title>
  <link rel="stylesheet" href="index.css">

  <!-- Firebase App (core SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <h1>🚗 Game Cars Showcase</h1>
    <input type="text" id="searchBox" placeholder="Search cars...">
  </header>

  <div class="gallery" id="gallery">
    <!-- Car Cards -->
    <div class="car-card" data-id="car1" data-name="Mahindra Thar">
      <img src="front-left-side-47.avif" onclick="openCar('car1')" alt="Car 1">
      <h3>Mahindra Thar</h3>
      <div class="rating">
        <span data-value="1">☆</span>
        <span data-value="2">☆</span>
        <span data-value="3">☆</span>
        <span data-value="4">☆</span>
        <span data-value="5">☆</span>
      </div>
      <p class="rating-text">Ratings: 0</p>
    </div>

    <div class="car-card" data-id="car2" data-name="Scorpio S11">
      <img src="front-left-side-47.avif" onclick="openCar('car2')" alt="Car 2">
      <h3>Scorpio S11</h3>
      <div class="rating">
        <span data-value="1">☆</span>
        <span data-value="2">☆</span>
        <span data-value="3">☆</span>
        <span data-value="4">☆</span>
        <span data-value="5">☆</span>
      </div>
      <p class="rating-text">Ratings: 0</p>
    </div>

    <div class="car-card" data-id="car3" data-name="Racer X">
      <img src="front-left-side-47.avif" onclick="openCar('car3')" alt="Car 3">
      <h3>Racer X</h3>
      <div class="rating">
        <span data-value="1">☆</span>
        <span data-value="2">☆</span>
        <span data-value="3">☆</span>
        <span data-value="4">☆</span>
        <span data-value="5">☆</span>
      </div>
      <p class="rating-text">Ratings: 0</p>
    </div>
  </div>

  <script>
    // 🔗 Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDUefeJbHKIAs-l3zvFlGaas6VD63vv4kI",
      authDomain: "inspire4ever-c60ad.firebaseapp.com",
      databaseURL: "https://inspire4ever-c60ad-default-rtdb.firebaseio.com",
      projectId: "inspire4ever-c60ad",
      storageBucket: "inspire4ever-c60ad.appspot.com",
      messagingSenderId: "125014633127",
      appId: "1:125014633127:web:d29e4c37628ab637f40982"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 🚘 Open Car Detail
    function openCar(carId){
      window.location.href = `car.html?id=${carId}`;
    }

    // ⭐ Rating System with Firebase (live for all users)
    document.querySelectorAll(".car-card").forEach(card => {
      const carId = card.dataset.id;
      const stars = card.querySelectorAll(".rating span");
      const ratingText = card.querySelector(".rating-text");
      const carRef = db.ref('cars/' + carId);

      // 🔹 Real-time listener
      carRef.on('value', snapshot => {
        const data = snapshot.val();
        const avg = data && data.ratingCount > 0 ? Math.round(data.totalRating / data.ratingCount) : 0;
        highlightStars(stars, avg);
        ratingText.innerText = `Ratings: ${avg}`;
      });

      stars.forEach(star => {
        star.addEventListener("mouseover", () => highlightStars(stars, star.dataset.value));
        star.addEventListener("mouseout", () => {
          carRef.once('value').then(snapshot => {
            const data = snapshot.val();
            const avg = data && data.ratingCount > 0 ? Math.round(data.totalRating / data.ratingCount) : 0;
            highlightStars(stars, avg);
          });
        });

        // Click to update Firebase
        star.addEventListener("click", () => {
          const ratingValue = parseInt(star.dataset.value);
          carRef.transaction(currentData => {
            if(currentData){
              currentData.totalRating += ratingValue;
              currentData.ratingCount += 1;
            } else {
              currentData = { totalRating: ratingValue, ratingCount: 1 };
            }
            return currentData;
          });
        });
      });
    });

    function highlightStars(stars, rating){
      stars.forEach(star => {
        if(star.dataset.value <= rating){
          star.classList.add("selected");
        } else {
          star.classList.remove("selected");
        }
      });
    }

    // 🔎 Search Functionality
    const searchBox = document.getElementById("searchBox");
    const cards = document.querySelectorAll(".car-card");
    searchBox.addEventListener("keyup", () => {
      const query = searchBox.value.toLowerCase();
      cards.forEach(card => {
        const name = card.getAttribute("data-name").toLowerCase();
        card.style.display = name.includes(query) ? "block" : "none";
      });
    });
  </script>
</body>
</html>
